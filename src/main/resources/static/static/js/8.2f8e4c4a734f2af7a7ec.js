webpackJsonp([8],{jHbU:function(s,t){},lqst:function(s,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=e("mvHQ"),n=e.n(a),i=e("P9l9"),c=e("YaEn"),o={name:"depositAsset",data:function(){return{assetObj:null,assetName:"",assetAddress:"",assetBalanceShow:!1,assetBalance:0,newAssetList:[],assetList:[],amount:0,showPicker:!1,htlcExchangeList:[],changeAssetList:[]}},mounted:function(){this.getAssets(),this.getHtlcExchange(),localStorage.getItem("changeAssetList")&&(this.changeAssetList=JSON.parse(localStorage.getItem("changeAssetList")))},methods:{getHtlcExchange:function(){var s=this;Object(i.n)().then(function(t){var e=t.status,a=t.data;200===e?a&&(s.htlcExchangeList=a):s.$notify({type:"warning",message:t.data.message})}).catch(function(t){s.$notify({type:"danger",message:"系统错误"})})},getAssets:function(){if(this.assetList=JSON.parse(localStorage.getItem("assetList")),this.assetList&&this.assetList.length)for(var s=0;s<this.assetList.length;s++)this.assetList[s].key==localStorage.getItem("userAddress")&&this.newAssetList.push(this.assetList[s]);localStorage.getItem("defaultAssetList")&&(this.newAssetList=this.newAssetList.concat(JSON.parse(localStorage.getItem("defaultAssetList"))))},onConfirm:function(s){var t=this;this.assetObj=s,this.showPicker=!1,this.assetAddress=s.contractAddress,this.assetName=s.shortName;var e={userAddress:localStorage.getItem("userAddress"),groupId:this.assetObj.groupId,contractAddress:this.assetObj.contractAddress};Object(i.k)(e).then(function(s){200===s.status?(s.data||0==s.data)&&(t.assetBalance=s.data,t.assetBalanceShow=!0):(t.$notify({type:"warning",message:s.data.message}),t.assetBalance=0,t.assetBalanceShow=!0)}).catch(function(s){t.$notify({type:"danger",message:"系统错误"}),t.assetBalance=0,t.assetBalanceShow=!0})},submit:function(){this.assetAddress?this.amount?this.queryExchangeDeposit():this.$notify({type:"warning",message:"请输入额度"}):this.$notify({type:"warning",message:"请选择资产"})},queryExchangeDeposit:function(){for(var s=this,t=null,e=0;e<this.htlcExchangeList.length;e++)this.htlcExchangeList[e].groupId==this.assetObj.groupId&&(t=this.htlcExchangeList[e].exchangeContractAddress);var a={userAddress:localStorage.getItem("userAddress"),groupId:this.assetObj.groupId,exchangeContractAddress:t},o={assetContractAddress:this.assetAddress,amount:this.amount,minUnit:this.assetObj.minUnit};Object(i.f)(a,o).then(function(e){if(200==e.status){s.assetObj.balance=0;for(var a=0,i=0;i<s.changeAssetList.length;i++)s.changeAssetList[i].contractAddress==s.assetObj.contractAddress&&s.assetObj.key==localStorage.getItem("userAddress")&&a++;0==a&&(s.assetObj.exchangeContractAddress=t,s.changeAssetList.push(s.assetObj),localStorage.setItem("changeAssetList",n()(s.changeAssetList))),c.a.push("/inTransaction")}else s.$notify({type:"warning",message:e.data.message})}).catch(function(t){s.$notify({type:"danger",message:"系统错误"})})}}},r={render:function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("div",{staticClass:"module"},[e("van-cell-group",[e("van-field",{attrs:{readonly:"",clickable:"",label:"资产名称",value:s.assetAddress,placeholder:"选择转出资产"},on:{click:function(t){s.showPicker=!0}}}),s._v(" "),s.assetBalanceShow?e("div",{staticStyle:{padding:"5px 0 5px 15px",color:"#ccc","font-size":"12px"}},[e("span",[s._v("资产剩余额度："+s._s(s.assetBalance))])]):s._e(),s._v(" "),e("van-field",{attrs:{label:"转出资产额度",placeholder:"请输入额度",required:""},model:{value:s.amount,callback:function(t){s.amount=t},expression:"amount"}})],1),s._v(" "),e("van-popup",{attrs:{position:"bottom"},model:{value:s.showPicker,callback:function(t){s.showPicker=t},expression:"showPicker"}},[e("van-picker",{attrs:{"show-toolbar":"",columns:s.newAssetList,"value-key":"shortName"},on:{cancel:function(t){s.showPicker=!1},confirm:s.onConfirm}})],1),s._v(" "),e("div",{staticClass:"cross-bottom"},[e("van-button",{staticStyle:{width:"100%"},attrs:{type:"default"},on:{click:s.submit}},[s._v("确定")])],1)],1)},staticRenderFns:[]};var l=e("VU/8")(o,r,!1,function(s){e("jHbU")},null,null);t.default=l.exports}});