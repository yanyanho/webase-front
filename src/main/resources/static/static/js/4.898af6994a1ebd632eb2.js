webpackJsonp([4],{kO8u:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("mvHQ"),n=i.n(s),a=i("yt7g"),r=i("P9l9"),o=i("YaEn"),c={name:"createOrder",data:function(){return{initiatorAsset:"",recipientAsset:"",initiatorAssetName:"",recipientAssetName:"",showPicker:!1,showPicker1:!1,columns:[],recipient:"",recipientAddress:"",secerte:"",initiatorAccount:0,recipientAccount:0,currentTime:Object(a.e)(108e5),showTime:!1,assetList:JSON.parse(localStorage.getItem("assetList"))||[],time:"",newAssetList:[],htlcList:[],initiatorBalance:0,initiatorBalanceShow:!1,recipientBalance:0,recipientBalanceShow:!1,userList:[],showUser:!1}},mounted:function(){this.getAssets(),this.gethtlcContractAddress(),this.getPrivateKeys()},methods:{initiatorBlur:function(){var t=this.initiatorAccount.toString().split(".")[1];t&&t.length>this.initiatorAsset.minUnit&&(this.initiatorAccount=0,this.$notify({type:"warning",message:"转账额度精度超过资产精度"}))},recipientBlur:function(){var t=this.recipientAccount.toString().split(".")[1];t&&t.length>this.recipientAsset.minUnit&&(this.recipientAccount=0,this.$notify({type:"warning",message:"转账额度精度超过资产精度"}))},getPrivateKeys:function(){var t=this;Object(r.s)().then(function(e){if(200==e.status)if(e.data.length){t.userList=e.data;for(var i=0;i<t.userList.length;i++)t.userList[i].address==localStorage.getItem("userAddress")&&t.userList.splice(i,1)}else t.$notify({type:"warning",message:e.data.message})}).catch(function(e){t.$notify({type:"danger",message:"系统错误"})})},onConfirmUser:function(t){this.recipient=t.userName,this.recipientAddress=t.address,this.showUser=!1},onConfirm:function(t){var e=this;this.initiatorAsset=t,this.initiatorAssetName=t.shortName,this.showPicker=!1;var i={userAddress:localStorage.getItem("userAddress"),groupId:this.initiatorAsset.groupId,contractAddress:this.initiatorAsset.contractAddress};Object(r.k)(i).then(function(t){200===t.status?(t.data||0==t.data)&&(e.initiatorBalance=t.data,e.initiatorBalanceShow=!0):(e.$notify({type:"warning",message:t.data.message}),e.initiatorBalance=0,e.initiatorBalanceShow=!0)}).catch(function(t){e.$notify({type:"danger",message:"系统错误"}),e.initiatorBalance=0,e.initiatorBalanceShow=!0})},onConfirm1:function(t){var e=this;this.recipientAsset=t,this.recipientAssetName=t.shortName,this.showPicker1=!1;var i={userAddress:localStorage.getItem("userAddress"),groupId:this.recipientAsset.groupId,contractAddress:this.recipientAsset.contractAddress};Object(r.k)(i).then(function(t){200===t.status?(t.data||0==t.data)&&(e.recipientBalance=t.data,e.recipientBalanceShow=!0):(e.$notify({type:"warning",message:t.data.message}),e.recipientBalance=0,e.recipientBalanceShow=!0)}).catch(function(t){e.$notify({type:"danger",message:"系统错误"}),e.recipientBalance=0,e.recipientBalanceShow=!0})},getUserBalance:function(t){},checkTime:function(t){Object(a.c)(t)>(new Date).getTime()+3e5?(this.time=t,this.showTime=!1):this.$notify({type:"warning",message:"超时时间必须设置大于一个半小时"})},getAssets:function(){if(this.assetList&&this.assetList.length)for(var t=0;t<this.assetList.length;t++)this.assetList[t].key==localStorage.getItem("userAddress")&&this.newAssetList.push(this.assetList[t])},gethtlcContractAddress:function(){var t=this;Object(r.m)().then(function(e){200==e.status?e.data&&"{}"!=n()(e.data)&&(t.htlcList=e.data):t.$notify({type:"warning",message:e.data.message})}).catch(function(e){t.$notify({type:"danger",message:"系统错误"})})},submit:function(){this.recipient?this.secerte?this.initiatorAssetName?this.initiatorAccount?this.recipientAssetName?this.recipientAccount?this.time?this.setdeposit():this.$notify({type:"warning",message:"请输入过期时间"}):this.$notify({type:"warning",message:"请输入转入资产额度"}):this.$notify({type:"warning",message:"请选择转入资产"}):this.$notify({type:"warning",message:"请输入转出资产额度"}):this.$notify({type:"warning",message:"请选择转出资产"}):this.$notify({type:"warning",message:"请输入密文"}):this.$notify({type:"warning",message:"请选择接收者"})},setdeposit:function(){var t=this,e=Object(a.c)(this.time);console.log(this.initiatorAsset,this.recipientAsset);var i={htlcContractAddress:this.htlcList[this.initiatorAsset.groupId],initiator:localStorage.getItem("userAddress"),initiatorAssetAddress:this.initiatorAsset.contractAddress,initiatorAssetAmount:this.initiatorAccount,initiatorAssetGroup:this.initiatorAsset.groupId,initiatorAssetName:this.initiatorAssetName,initiatorLockTime:e,recipient:this.recipientAddress,recipientAssetAddress:this.recipientAsset.contractAddress,recipientAssetAmount:this.recipientAccount,recipientAssetGroup:this.recipientAsset.groupId,recipientAssetName:this.recipientAssetName,secerte:this.secerte};Object(r.c)(i).then(function(e){200==e.status?(t.$notify({type:"success",message:"存入成功"}),o.a.push("/crossLink")):t.$notify({type:"warning",message:e.data.message})}).catch(function(e){t.$notify({type:"danger",message:"系统错误"})})}}},l={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("van-cell-group",[i("van-field",{attrs:{label:"接受者地址",placeholder:"请输入接受者地址"},on:{click:function(e){t.showUser=!0}},model:{value:t.recipient,callback:function(e){t.recipient=e},expression:"recipient"}}),t._v(" "),i("van-field",{attrs:{label:"密文",placeholder:"请输入密文",required:""},model:{value:t.secerte,callback:function(e){t.secerte=e},expression:"secerte"}}),t._v(" "),i("van-field",{attrs:{readonly:"",clickable:"",label:"发起者资产",value:t.initiatorAssetName,placeholder:"选择发起者资产"},on:{click:function(e){t.showPicker=!0}}}),t._v(" "),t.initiatorBalanceShow?i("div",{staticStyle:{padding:"5px 0 5px 15px",color:"#ccc","font-size":"12px"}},[i("span",[t._v("资产剩余额度："+t._s(t.initiatorBalance))])]):t._e(),t._v(" "),i("van-field",{attrs:{label:"发起者额度",placeholder:"请输入额度",required:""},on:{input:t.initiatorBlur},model:{value:t.initiatorAccount,callback:function(e){t.initiatorAccount=e},expression:"initiatorAccount"}}),t._v(" "),i("van-field",{attrs:{readonly:"",clickable:"",label:"接受者资产",value:t.recipientAssetName,placeholder:"选择接受者资产"},on:{click:function(e){t.showPicker1=!0}}}),t._v(" "),t.recipientBalanceShow?i("div",{staticStyle:{padding:"5px 0 5px 15px",color:"#ccc","font-size":"12px"}},[i("span",[t._v("资产剩余额度："+t._s(t.recipientBalance))])]):t._e(),t._v(" "),i("van-field",{attrs:{label:"接受者额度",placeholder:"请输入额度",required:""},on:{input:t.recipientBlur},model:{value:t.recipientAccount,callback:function(e){t.recipientAccount=e},expression:"recipientAccount"}}),t._v(" "),i("van-field",{attrs:{label:"过期时间",placeholder:"请选择过期时间",required:"","right-icon":"info"},on:{click:function(e){t.showTime=!0},"click-right-icon":function(e){return t.$toast("超时时间必须设置大于一个半小时")}},model:{value:t.time,callback:function(e){t.time=e},expression:"time"}})],1),t._v(" "),i("van-popup",{attrs:{position:"bottom"},model:{value:t.showUser,callback:function(e){t.showUser=e},expression:"showUser"}},[i("van-picker",{attrs:{"show-toolbar":"",columns:t.userList,"value-key":"userName"},on:{cancel:function(e){t.showUser=!1},confirm:t.onConfirmUser}})],1),t._v(" "),i("van-popup",{attrs:{position:"bottom"},model:{value:t.showPicker,callback:function(e){t.showPicker=e},expression:"showPicker"}},[i("van-picker",{attrs:{"show-toolbar":"",columns:t.newAssetList,"value-key":"shortName"},on:{cancel:function(e){t.showPicker=!1},confirm:t.onConfirm}})],1),t._v(" "),i("van-popup",{attrs:{position:"bottom"},model:{value:t.showTime,callback:function(e){t.showTime=e},expression:"showTime"}},[i("van-datetime-picker",{attrs:{type:"time"},on:{cancel:function(e){t.showTime=!1},confirm:t.checkTime},model:{value:t.currentTime,callback:function(e){t.currentTime=e},expression:"currentTime"}})],1),t._v(" "),i("van-popup",{attrs:{position:"bottom"},model:{value:t.showPicker1,callback:function(e){t.showPicker1=e},expression:"showPicker1"}},[i("van-picker",{attrs:{"show-toolbar":"",columns:t.newAssetList,"value-key":"shortName"},on:{cancel:function(e){t.showPicker1=!1},confirm:t.onConfirm1}})],1),t._v(" "),i("div",{staticClass:"cross-bottom"},[i("van-button",{staticStyle:{width:"100%"},attrs:{type:"default"},on:{click:t.submit}},[t._v("确定")])],1)],1)},staticRenderFns:[]};var h=i("VU/8")(c,l,!1,function(t){i("xXxa")},"data-v-fc7311c0",null);e.default=h.exports},xXxa:function(t,e){}});