# BAC资产管理服务
## 简介
此服务是BAC的资产管理工具，目前主要有资产管理和跨链交易两个功能；

- 资产管理：
资产管理可以管理跨群组资产，支持添加资产，输入合约地址和群组ID，即可显示自己的余额。并支持转账。

- 跨链交易：
跨链交易是基于哈希时间锁实现的。哈希锁定通过时间差和隐藏哈希值来实现资产的原子交换。
哈希时间锁的结构如图1所示： ![HTLC原理](images/htlc.jpg)
 交互流程如图所示： ![跨链资产交易](images/htlc2.png)

## 用户手册：
1 先在资产管理添加要进行跨链交易的资产；如群组1的AAA和 群组2的BBB，添加成功后会显示资产余额；
2 进入跨链资产交易界面：选择发起方或者接收方。无论接收方和发起方，交易步骤都是3步；存入资产，取出对方资产，以及超时取回自己资产；
3 存入资产： 
   发起方输入 接受者，密文，转出的资产（自己的待交换资产） 和转入资产（对手方的资产）数量；并选择过期时间，默认发起方是3小时，点击提交会返回合同ID，并告知接收方；
   如果是接收方的话需输入发起方的合同ID， 由发起方线下告诉接收方，成功提交后会返回另外一个合约id(接收方合约id)，接收方需要把接收方的合约id也告诉发起方
4 取回资产： 发起方输入 接收方合约id， 并输入自己第一步设置的密语，取回资产。 
             接收方收到发起方取回资产的通知，获得了密语，也会输入发起方的合约id和密语，取回发起方的资产。交易完成。
5 超时取回： 存入资产无论发起方还是接收方都会设置超时时间，如果超时时间过了。可以取回自己存入合约的资产。                     

## 安装说明
  
  使用方式跟WeBASE-Front服务类似，服务启动后 输入{ip}：5002即可进入界面。
## 1. 拉取代码
执行命令：
```
git clone git@git.weoa.com:ttip/bac-trade.git
```

进入目录：

```
cd bac-trade
```

## 2. 编译代码

执行构建命令：

```
chmod +x ./gradlew
./gradlew build -x test
```

构建完成后，会在根目录下生成已编译的代码目录dist。

## 3. 修改配置

（1）进入dist目录

```
cd dist
```

（2）进入conf目录：

```shell
cd conf
```

**注意：** 需要将节点所在目录`nodes/${ip}/sdk`下的`ca.crt`、`node.crt`和`node.key`文件拷贝到当前conf目录，供SDK与节点建立连接时使用。

（3）修改配置（根据实际情况修改）：

```
vi application.yml
```

``` 
spring:
  datasource:
    url: jdbc:h2:file:./h2/webasefront;DB_CLOSE_ON_EXIT=FALSE // 默认H2库为webasefront
...
server: 
  port: 5003                    // 服务端口
  context-path: /
sdk: 
  ...
  ip: 127.0.0.1                 // 连接节点的监听ip
  channelPort: 20200            // 连接节点的链上链下端口
```

## 4. 服务启停

返回到dist目录执行：
```shell
启动: bash start.sh
停止: bash stop.sh
检查: bash status.sh
```
**备注**：如果脚本执行错误，尝试以下命令:

```
赋权限：chmod + *.sh
转格式：dos2unix *.sh
```

## 5. 访问控制台

```
http://{deployIP}:{frontPort}
示例：http://localhost:5002/
```
